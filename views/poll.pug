doctype html
html
  head
    title FCC voting app
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    link(rel='stylesheet', href='../style.css')
    link(type="text/css",rel='stylesheet', href="../bootstrap.css")
    script(type="text/javascript", src="../jquery-3.2.1.min.js")  
    script(src="../bootstrap.js")
    script(src="../script.js")

    <!--[if lt IE 9]>
     <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
     <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->M
  
  body
    - var myUrl = websiteUrl + '/polls/' + pollName;
    - var websiteUrl = "https://fancy-thrill.glitch.me"
    .container
      nav.navbar.navbar-default
          .container-fluid
            // Brand and toggle get grouped for better mobile display
            .navbar-header
              button.navbar-toggle.collapsed(type='button', data-toggle='collapse', data-target='#bs-example-navbar-collapse-1', aria-expanded='false')
                span.sr-only Toggle navigation
                span.icon-bar
                span.icon-bar
                span.icon-bar 
                
              a.navbar-brand(href=websiteUrl) FCC-voting
            // Collect the nav links, forms, and other content for toggling
            #bs-example-navbar-collapse-1.collapse.navbar-collapse
              ul.nav.navbar-nav.navbar-right
                li.active
                  a(href=websiteUrl) Home
                if userAuth  
                  li
                    a(href=websiteUrl + "/mypolls") My Polls
                  li
                    a(href=websiteUrl + "/newpoll") New Poll
                  li.dropdown
                    a.dropdown-toggle(, data-toggle='dropdown', role='button', aria-haspopup='true', aria-expanded='false')
                      | #{userName} 
                      span.caret
                    |                   
                    ul.dropdown-menu
                      li
                        a(href=websiteUrl + "/signout") Sign Out
                else
                  li
                    a(href="https://fancy-thrill.glitch.me/request-token" id="signup") Sign in with Twitter
            // navbar-collapse
          // container-fluid

  
  

  - var pollName = "what do you like?"
  - var polls = ['tomato', 'carrots', 'cheese']
  .content.container
    .col-md-4
      h3= pollName
      form.form-group  
        label #[h2 #[b I'd like to vote for:]]
        select.form-control
          each val in polls
            option= val
        br
        input.btn.btn-block.btn-primary(type="submit" value="submit")
        br
        
        
        if userAuth 
          form.form-group.row(action=myUrl)
            input.col-xs-8(type="text", name="newOption", placeholder="add a new option ...")
            input.btn.btn-primary(type="submit", value="add", style="float: left;padding: 2px 10px" ) 
        
        br
        .btn.btn-info.btn-block#share share on twitter
        br
    .col-md-8(style="text-align: center;")
      canvas.center-block#myChart(width='400', height='400', style='max-width: 500px; max-height: 500px;')
      
      if userAuth
        br
        .btn.btn-block.btn-danger Remove This Poll
      
      script(src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.min.js')
      script.
        // remove poll
        $(".btn-danger").click(function(){
          if(confirm("Are you sure you want to delete this poll?")){ 
            $.ajax({
              url: window.location.href + "?remove=1", 
              method: "post",
              success: function(){
                window.location.href= "https://fancy-thrill.glitch.me";
              },
              error: function(){
                alert("Sorry an Error happened");
              }
              
            })
          }
        })  
        
        $("#share").click(function(){
          var a = window.location.href.split('/')
          var pollName = a[ a.length - 1 ];
          console.log(pollName)
          var width  = 575,
            height = 400,
            left   = ($(window).width()  - width)  / 2,
            top    = ($(window).height() - height) / 2,
            url    = "http://twitter.com/share?text=" + decodeURI(pollName) + " | Fcc-Voting | " + window.location.href ,
            opts   = 'status=1' +
                     ',width='  + width  +
                     ',height=' + height +
                     ',top='    + top    +
                     ',left='   + left;
          url = encodeURI(url)
          window.open(url, 'twitter', opts);
        })
      
        // graph
        var usedColors = [];
        function generateRandomColor(){
          var r = Math.floor(Math.random()*254),
          g = Math.floor(Math.random()*254),
          b = Math.floor(Math.random()*254),
          opacity = Math.random()
          var color = "rgba(" + r + ", " + g + ", " + b + ", " + opacity + ")";
          return color.toString();111
        }
        var ctx = document.getElementById("myChart").getContext('2d');
        var myChart = new Chart(ctx, {
          type: 'pie',
          data: {
            labels: ["Red", "Blue", "Yellow", "Green", "Purple", "Orange"],
            datasets: [{
              label: '# of Votes',
              data: [12, 19, 3, 5, 2, 3],
              backgroundColor: [
                generateRandomColor(),
                generateRandomColor(),
                generateRandomColor(),
                generateRandomColor(),
                generateRandomColor(),
                generateRandomColor(),
              ],
            }]
          },
          options: {
            maintainAspectRatio: true,
          }
        });

        
  
  .container
  h5(style="text-align:center") #[b This "fcc-voting" app is built by #[a(href="https://github.com/moaz-eldefrawy", target="_blank") Moaz ELdefrawy]] 
  